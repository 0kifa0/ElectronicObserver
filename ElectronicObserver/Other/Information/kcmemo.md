## 艦これの仕様に関する雑多なメモ
---

* **特注家具職人が必要な条件**  
2000≦price<20000  
とくに特別なフラグはない。  

* **ケッコンカッコカリ後の耐久値**  
ケッコン前の最大耐久値及び「最大耐久値の最大値」にのみ依存する。艦種や艦型、ケッコンのタイミングなどの影響は受けない。
 
    - HP < 30 : +4
    - HP < 40 : +5
    - HP < 50 : +6
    - HP < 70 : +7
    - HP < 90 : +8
    - HP >= 90 : +9  

    「最大耐久値の最大値」は艦ごとに個別に設定されており、この値を超えることはない。  
    殆どの艦では上記増分値を足しても問題ないほど大きく設定されているが、Bismarck drei など一部の艦娘はこれによって上昇量が制限されている。

* **対潜・回避・索敵パラメータの算出式**  
value = min + int( ( max - min ) * Lv / 99 )  
なお、max = Lv99時点での値。  
「改装して最大値は変わらないが最小値が上昇する艦娘」(島風の回避など)の場合、Lv100を超えると改装前のほうが強くなることがある。  
なお、火力・雷装・対空・装甲はランダムに上昇する(らしい)。

* **季節の衣替え艦娘**  
クリスマス・年末・正月に衣装替えした艦娘のデータは ID 901 以降に保存されており、図鑑からのみ参照できる。  
なお、システム内では 501 以降の艦は深海棲艦として扱われるため、一応深海棲艦扱い。  

* **SuperAAItem**  
以下のアイテムが該当する。
    * 3: 10cm連装高角砲
    * 9: 46cm三連装砲
    * 10: 12.7cm連装高角砲
    * 35: 三式弾
    * 48: 12.7cm単装高角砲
   
    現在は未使用?  
    
* **ダメージ処理**  
実際の状態にかかわらず、15未満だと常に非クリティカル, 40以上だと常にクリティカルとして表示される。
実際に出せるかはさておき、表示上の最大値は9999。  
また、「かばう」が発動した場合は 0.1 がフラグとして加算される。  

* **ダメコン処理の優先度**  
スロットの上にあるほうから使われる。　　

* **挟叉**  
命中フラグは以下のようになっている。  
* `HITFLG_NOATTACKED` : 攻撃せず(-1)
* `HITFLG_MISS` : ミス(0)
* `HITFLG_NORMAL` : 命中(1)
* `HITFLG_CRITICAL` : クリティカル(2)
* `HITFLG_KYOUSA` : 狭叉(3) (原文ママ, 未実装?)  

* **航空支援での敵機撃墜**  
航空支援でも敵機を撃墜することは可能。  
ただし既に航空戦フェーズは終わっているので、狙ってまでする事ではなさそう。  

* **レアリティの設定ミス**  
羽黒改二はデータ上は金色扱い(グラフィック上は虹色)。  
他にもいた気がする…  

* **ダメコン使用時の回復量**
    - 応急修理要員 : HP = int( HPMax * 0.2 )
        - 旗艦大破進撃時は HP = int( HPMax * 0.5 )
    - 応急修理女神 : HP = HPMax ( +燃料・弾薬全回復 )  

* **保有数による出撃時の制限**  
    - 艦船がドロップしない条件  
    艦船空き == 0 or 装備空き <= 2  
    - イベント海域出撃不可条件  
    艦船空き < 5 or 装備空き < 20

* **攻撃種別**  
    * 昼戦
        * 0: 砲撃  
        * 1: レーザー攻撃
        * 2: 連撃
        * 3: カットイン(主砲/副砲)  
        * 4: カットイン(主砲/電探)
        * 5: カットイン(主砲/徹甲弾)
        * 6: カットイン(主砲/主砲)
        * 7: 空撃
        * 8: 爆雷攻撃
        * 9: 雷撃
    * 夜戦
        * 0: 砲撃  
        * 1: 連撃
        * 2: カットイン(主砲/魚雷)
        * 3: カットイン(魚雷/魚雷)
        * 4: カットイン(主砲/主砲/副砲)
        * 5: カットイン(主砲/主砲/主砲)
        * 6: ???
        * 7: 空撃
        * 8: 爆雷攻撃
        * 9: 雷撃  

    なお、通常 7 以降のデータは送られてこないが、以下の式によって蔵側で判定される。  

```
//昼戦の攻撃種別判定
if ( 攻撃種別 != 0 ) (そのまま採用);
else if ( 攻撃側 == ( 軽空母 | 正規空母 | 装甲空母 ) ) 攻撃種別 = 7(空撃);
else if ( 防御側 == ( 潜水艦 | 潜水空母 ) ) {
	if ( 攻撃側 == ( 航空巡洋艦 | 航空戦艦 | 水上機母艦 | 揚陸艦 ) ) 攻撃種別 = 7(空撃);
	else 攻撃種別 = 8(爆雷攻撃);
} else if ( 最初の表示装備(api_si_list)のカテゴリ == 魚雷 ) 攻撃種別 = 9(雷撃);
```

```
//夜戦の攻撃種別判定
if ( 攻撃種別 != 0 ) (そのまま採用);
else if ( 攻撃側 == ( 軽空母 | 正規空母 | 装甲空母 ) ) 攻撃種別 = 7(空撃);
else if ( 防御側 == ( 潜水艦 | 潜水空母 ) ) {
	if ( 攻撃側 == ( 航空巡洋艦 | 航空戦艦 | 水上機母艦 | 揚陸艦 ) ) 攻撃種別 = 7(空撃);
	else 攻撃種別 = 8(爆雷攻撃);
} else if ( 攻撃側 == ( 潜水艦 | 潜水空母 ) ) 攻撃種別 = 9(雷撃);
else if ( 最初の表示装備(api_si_list)のカテゴリ == 魚雷 ) 攻撃種別 = 9(雷撃);
else 攻撃種別 = 0(砲撃);
```

* **敵ボイス**  
`areaID` `mapNo` `index` `shipID`  

* **装備種別**  
    * [0]: 大分類？
    * [1]: 図鑑カテゴリ/戦闘分類(`getSlotItemCardType`)
    * [2]: 装備種別(`getSlotItemEquipType`)
    * [3]: アイコン(`getSlotItemIconType`)

* **夜戦魚雷連撃**  
一応実装されているらしい。  
連撃フラグが立っており、かつ攻撃表示装備[0]が主砲/副砲でないときに発動する。  
そういったデータが送られてくることはないので通常の手段では見ることはできない。  

* **`hasAntiAircraftAbility`**  

```
int flag = 0;
foreach ( 装備スロット ) {
	int priority = 0;
	if ( カテゴリ == 対空強化弾 ) priority = 1;
	else if ( アイコン == 高角砲 ) priority = 3;
	else if ( 装備 == 12cm30連装噴進砲 ) priority = 2;
	else if ( カテゴリ == 対空機銃 ) priority = 4;
	else if ( アイコン == 電探 && 対空 > 0 ) priority = 4;

	if ( priority > 0 && ( priority < flag || flag == 0 ) )
		flag = priority;	//優先度の高いものを選択
}
if ( flag == 2 ) flag = 3;
else if ( flag == 3 ) flag = 2;		//謎のスワップ 
return flag;
```

* **泊地修理の仕様**
(英wikiその他より)
    * 判定はタイマーが20分以上になった状態で母港に移動すると行われる。詳細は後述。
    * 工作艦を旗艦に置く必要がある。第1艦隊である必要はない。
    * 以下の条件を満たすとき修理は行われない。
        * 旗艦が中破以上のダメージを受けている。(?)
        * 旗艦が入渠中である。
        * 艦隊が遠征中である。
    * 以下の条件を満たす艦娘は修理対象とならない。
        * 中破以上のダメージを受けている。
        * 修理の範囲外にいる。
        * 既に入渠している。
        * 修復に必要な資材が足りない。
    * 編成を変更した瞬間にタイマーはリセットされる。  
    言い換えれば、編成を変更した時点でタイマーのカウントは開始される。
    * 艦隊を出撃させてもタイマーはリセットされない。
    * 随伴艦を入渠させること・装備変更することはタイマーに影響しない。
    * 修理中はオフラインでも構わない。
    * 修理はコンディション(cond)に依存しない。
    * 修理可能艦数は ( 2 + 艦艇修理施設の装備数 )。旗艦も含む。
    * 20分以上経過した状態で中断すると少なくとも1回復する。そのため、高レベル・長時間入渠の艦は入渠での修理よりも早く終わることがある。
    * 修理コストは*中断しない限り*入渠での修理と同じになる。  
    中断した場合は入渠より多くかかることがある。
    * 修理時間は分単位切り捨てで処理される。
    * HP1当たりの回復時間は入渠と同じ。  
    `回復量 = max( ceiling( 修理時間 / 各艦の回復単位時間 ) - 1, 1 )` となる。
    * 消費資材は回復値に応じる(ceil)。消費資材が足りない場合、修理は行われない。  
    但し、タイマー開始時に足りなくても修理処理時に自然回復によって資源が賄えた場合は修理が行われる。
    * 修理時間のタイマーは共通になっているらしく、複数艦隊で修理するときは注意が必要?

* **時報の読み込みタイミング**  
サーバの混雑を回避するためか、時間の5分ほど前から読み込みを開始することがある。  
詳細は未調査。  

